function [result,ResultsT,ResultsI,ResultsU,ResultsT1,ResultsS,ResultsE,ResultsR]= ParameterOptim_020279
tic%西班牙版本
close all
data = load('2319.mat');%起始时间2/
xi = data.xi;
xi(3:end-2)=(xi(1:end-4)+xi(2:end-3)+xi(3:end-2)+xi(4:end-1))/4;%数据做了光滑处理
%xi=xi*0.4;
n_in=15104;%中国到西班牙
n_out=7933;%西班牙 飞往中国大陆
x0 = [46730000;2200;80;10;2;0;0];%S,E,I,U,T,R
tspan = linspace(0,33,34);
%tspan2 = linspace(0,99,100);
a=0.70;%miu1
%b=0.03;%miu2  
c=0.3;%miu3  U的比例
d=1/7;% 潜伏期
e=1/7;%锟斤拷2
f=1/14;% T to R
g=0.00354;%死亡率
k=1/5.2;%I to T
%p=5e-5.*(t>=8)+2e-5.*(t>=0&t<8); %武汉人口流入全国的人群中潜伏者的比例
h1h2h30 = [0.03 0.02 0.01];
result = fminsearch(@ObjFun1,h1h2h30);
D = ObjFun2(result);
[ResultsT,ResultsI,ResultsU,ResultsT1,ResultsS,ResultsE,ResultsR]=(ObjFun2(result));
plot(xi,'b')
hold on
plot(D,'r')
legend('锟斤拷实锟斤拷锟????','模锟酵硷拷锟斤拷锟斤拷锟????')
    function D = ObjFun1(h1h2h3)
         h1 = h1h2h3(1);
          %q = h1(2);
         h2 = h1h2h3(2);
         h3 = h1h2h3(3);
     fun = @(t,x)[(n_in.*2*(t>=0&t<17)+0.*(t>17))*(1-0.000897461)-(n_out*(t>=0&t<17)+0.*(t>17))-((h1*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(2))+h2*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(3)+h3*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(4))/(x(1)+x(2)+x(3)+x(4)+x(5)+x(6));
((h1*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(2))+h2*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(3)+h3*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(4))/(x(1)+x(2)+x(3)+x(4)+x(5)+x(6))+(n_in.*2*(t>=0&t<17)+0.*(t>17))*0.000897461-x(2)*d;
d*x(2)*a-g*x(3)-(0.2/15*t*(t>=0&t<15)+(0.2/5*(t-15)+0.2)*(t>=15&t<20)+0.4.*(t>=20))*k*x(3);%检出率
d*x(2)*c-e*x(4);
(0.2/15*t*(t>=0&t<15)+(0.2/5*(t-15)+0.2)*(t>=15&t<20)+0.4.*(t>=20))*k*x(3)-x(5)*f;
e*x(4)+f*x(5);
x(5)*f];
        [~,x] = ode45(fun,tspan,x0);
        D = sqrt(sum(([x(1,5);x(2:end,5)-x(1:end-1,5)+x(2:end,7)-x(1:end-1,7)]-xi)'.^2))+1e7*(h1<0);
    end
     function [D,I,U,T1,S,E,R] = ObjFun2(h1h2h3)
         h1 = h1h2h3(1);
          %q = h1(2);
         h2 = h1h2h3(2);
         h3 = h1h2h3(3);
      fun = @(t,x)[(n_in.*2*(t>=0&t<17)+0.*(t>17))*(1-0.000897461)-(n_out*(t>=0&t<17)+0.*(t>17))-((h1*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(2))+h2*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(3)+h3*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(4))/(x(1)+x(2)+x(3)+x(4)+x(5)+x(6));
((h1*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(2))+h2*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(3)+h3*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(1)*(1-(0.3/10.*t.*(t>=0&t<10)+(0.1/10*(t-10)+0.3)*(t>=10&t<20)+0.4.*(t>=20)))*x(4))/(x(1)+x(2)+x(3)+x(4)+x(5)+x(6))+(n_in.*2*(t>=0&t<17)+0.*(t>17))*0.000897461-x(2)*d;
d*x(2)*a-g*x(3)-(0.2/15*t*(t>=0&t<15)+(0.2/5*(t-15)+0.2)*(t>=15&t<20)+0.4.*(t>=20))*k*x(3);%检出率
d*x(2)*c-e*x(4);
(0.2/15*t*(t>=0&t<15)+(0.2/5*(t-15)+0.2)*(t>=15&t<20)+0.4.*(t>=20))*k*x(3)-x(5)*f;
e*x(4)+f*x(5);
x(5)*f];
        [~,x] = ode45(fun,tspan,x0);
         D = [x(1,5);x(2:end,5)-x(1:end-1,5)+x(2:end,7)-x(1:end-1,7)];
        I = x(:,3);%实时的I
        U =x(:,4);%实时的U
        T1 =x(:,5);
        S = x(:,1);
        E = x(:,2);
        R = x(:,6);
    end
toc
end
%[a b c d e f g h]=ParameterOptim_020279
%data = load('2313.mat');
%xi = data.xi;
%xi(3:end-2)=(xi(1:end-4)+xi(2:end-3)+xi(3:end-2)+xi(4:end-1))/4;以上三条均为导出光滑数据
